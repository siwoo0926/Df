<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no, viewport-fit=cover">
    <title>ì‹œìš°ì˜ê³µì±…RPG: ë§ˆë²•ê³µë°© & ìƒì </title>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Gaegu:wght@400;700&display=swap');
        :root { --paper: #fdfdfd; --line: #d1e4f3; --ink: #222; --red: #d63031; --green: #00b894; --gold: #fdcb6e; --purple: #6c5ce7; }
        * { box-sizing: border-box; -webkit-tap-highlight-color: transparent; font-family: 'Gaegu', cursive; }
        body, html { margin: 0; padding: 0; width: 100%; height: 100%; background: #333; overflow: hidden; display: flex; justify-content: center; }

        #app { width: 100%; max-width: 450px; height: 100%; background: var(--paper); background-image: linear-gradient(var(--line) 1.5px, transparent 1.5px), linear-gradient(90deg, var(--line) 1.5px, transparent 1.5px); background-size: 30px 30px; border-left: 20px solid #555; position: relative; display: flex; flex-direction: column; }
        
        .header { background: #000; color: #fff; height: 50px; display: flex; justify-content: space-between; align-items: center; padding: 0 15px; font-size: 18px; }
        .header-sub { height: 45px; background: #222; color: #fff; display: flex; justify-content: space-around; align-items: center; border-top: 1px solid #444; font-size: 13px; }

        .content-area { flex: 1; position: relative; overflow-y: auto; padding-bottom: 20px; }
        .panel { display: none; padding: 15px; }
        .panel.active { display: block; }

        /* ì „íˆ¬ UI */
        .scene { position: relative; height: 200px; display: flex; justify-content: space-around; align-items: flex-end; padding-bottom: 20px; border-bottom: 2px dashed #999; margin-bottom: 10px; }
        .unit-img { width: 80px; height: 80px; background: #fff; border: 2px solid #000; border-radius: 10px; display: flex; align-items: center; justify-content: center; font-size: 40px; position: relative; }
        .hp-bar { width: 80px; height: 10px; border: 1px solid #000; background: #eee; margin-bottom: 5px; }
        .hp-fill { height: 100%; background: var(--green); transition: 0.3s; }

        /* ê³µìš© ì¹´ë“œ ìŠ¤íƒ€ì¼ */
        .item-card { border: 2px solid #000; padding: 10px; margin: 8px 0; display: flex; justify-content: space-between; align-items: center; background: #fff; border-radius: 8px; }
        .item-card.selected { border-color: var(--purple); background: #f0ebff; box-shadow: 0 0 10px rgba(108, 92, 231, 0.3); }
        .workshop-box { background: #eee; border: 2px dashed #666; padding: 15px; text-align: center; border-radius: 10px; margin-bottom: 15px; }
        .enchant-tag { font-size: 11px; color: var(--purple); font-weight: bold; margin-right: 4px; }

        /* í•˜ë‹¨ ì»¨íŠ¸ë¡¤ */
        .bottom-ui { background: #fff; border-top: 4px solid #000; padding: 10px; }
        .action-grid { display: grid; grid-template-columns: repeat(3, 1fr); gap: 5px; margin-bottom: 10px; }
        .btn-act { padding: 8px; border: 2px solid #000; border-radius: 8px; font-size: 14px; cursor: pointer; background: #f9f9f9; }
        .btn-act.selected { background: var(--gold); }
        
        #gauge-box { width: 100%; height: 40px; border: 3px solid #000; position: relative; border-radius: 8px; overflow: hidden; margin-bottom: 10px; background: #fff; }
        .zone { position: absolute; height: 100%; top:0; display: flex; align-items: center; justify-content: center; font-weight: bold; font-size: 12px; color: white; text-shadow: 1px 1px 0 #000;}
        #needle { position: absolute; left: 0; top: 50%; transform: translate(-50%, -50%); font-size: 22px; z-index: 10; }

        .btn-main { width: 100%; padding: 12px; background: var(--ink); color: #fff; border: 4px solid #000; border-radius: 12px; font-size: 18px; font-weight: bold; cursor: pointer; margin-bottom: 5px; }
        .menu-grid { display: grid; grid-template-columns: repeat(5, 1fr); gap: 4px; margin-top: 10px; }
        .m-btn { border: 2px solid #000; border-radius: 8px; padding: 6px; text-align: center; cursor: pointer; background: #eee; font-size: 16px; }
        
        .shake { animation: shake 0.2s; }
        @keyframes shake { 0%, 100% { transform:translateX(0); } 25% { transform:translateX(5px); } 75% { transform:translateX(-5px); } }
    </style>
</head>
<body>

<div id="app">
    <div class="header"><span>âœ–</span> <b>ì‹œìš°ì˜ê³µì±…RPG</b> <span id="fever-txt" style="color:var(--gold); display:none;">FEVER!!</span></div>
    <div class="header-sub">
        <span>âš”ï¸ <b id="u-atk">25</b></span> <span>ğŸ›¡ï¸ <b id="u-def">5</b></span> <span>ğŸ’° <b id="u-gold">1000</b></span> <span>ğŸš© Stage <b id="u-stg">1</b></span>
    </div>

    <div class="content-area">
        <div id="p-battle" class="panel active">
            <div class="scene">
                <div class="char-box"><div class="hp-bar"><div id="h-hp" class="hp-fill"></div></div><div class="unit-img">ğŸ›¡ï¸</div><b>ê³„ìŠ¹ì</b></div>
                <div class="char-box"><div class="hp-bar"><div id="hp-e" class="hp-fill" style="background:var(--red)"></div></div><div id="mon-img" class="unit-img">ğŸ‘¾</div><b id="e-name">ëª¬ìŠ¤í„°</b></div>
            </div>
        </div>

        <div id="p-shop" class="panel">
            <h2 style="text-align:center;">ğŸ›’ í•„ê¸°êµ¬ ìƒì </h2>
            <div id="shop-list"></div>
        </div>

        <div id="p-inv" class="panel">
            <h2 style="text-align:center;">ğŸ’ ê°€ë°©</h2>
            <div id="inv-list"></div>
        </div>

        <div id="p-fuse" class="panel">
            <h2 style="text-align:center;">âœ¨ í“¨ì¦ˆ (ì¥ë¹„ í•©ì„±)</h2>
            <div id="fuse-slots" class="workshop-box">ì¥ë¹„ 2ê°œë¥¼ ì„ íƒí•˜ì„¸ìš”</div>
            <button class="btn-main" onclick="Game.doFuse()">í•©ì„±í•˜ê¸°</button>
            <div id="fuse-list"></div>
        </div>

        <div id="p-alch" class="panel">
            <h2 style="text-align:center;">ğŸ§ª ì—°ê¸ˆìˆ  (ë¬¼ì•½ ì—°ì„±)</h2>
            <div id="alch-slots" class="workshop-box">ë¬¼ì•½ 2ê°œë¥¼ ì„ íƒí•˜ì„¸ìš”</div>
            <button class="btn-main" onclick="Game.doAlch()" style="background:var(--green)">ì—°ì„±í•˜ê¸°</button>
            <div id="alch-list"></div>
        </div>

        <div id="p-ench" class="panel">
            <h2 style="text-align:center;">ğŸ”® ì¸ì±ˆíŠ¸ ê³µë°©</h2>
            <div id="ench-target" class="workshop-box">ë¶€ì—¬í•  ì¥ë¹„ë¥¼ ì„ íƒí•˜ì„¸ìš”</div>
            <button class="btn-main" onclick="Game.doEnchant()" style="background:var(--purple)">ì¸ì±ˆíŠ¸ ë¶€ì—¬ (500G)</button>
            <div id="ench-list"></div>
        </div>
    </div>

    <div class="bottom-ui">
        <div class="action-grid">
            <button class="btn-act" onclick="Game.selectMode('atk')">âš”ï¸ ê³µê²©</button>
            <button class="btn-act" onclick="Game.selectMode('eva')">ğŸƒ íšŒí”¼</button>
            <button class="btn-act" onclick="Game.selectMode('def')">ğŸ›¡ï¸ ë°©ì–´</button>
        </div>
        <div id="gauge-box">
            <div class="zone" style="width:30%; left:0; background:#ff4757;">MISS</div>
            <div id="z-hit" class="zone" style="width:50%; left:30%; background:var(--green);">HIT</div>
            <div class="zone" style="width:20%; left:80%; background:var(--gold);">CRIT</div>
            <div id="needle">ğŸ–‹ï¸</div>
        </div>
        <button id="main-btn" class="btn-main" onclick="Game.execute()" disabled>ì•¡ì…˜ ì„ íƒ</button>
        <div class="menu-grid">
            <div class="m-btn" onclick="Game.tab('p-battle')">âš”ï¸</div>
            <div class="m-btn" onclick="Game.tab('p-shop')">ğŸ›’</div>
            <div class="m-btn" onclick="Game.tab('p-inv')">ğŸ’</div>
            <div class="m-btn" onclick="Game.tab('p-fuse')">âœ¨</div>
            <div class="m-btn" onclick="Game.tab('p-ench')">ğŸ”®</div>
        </div>
    </div>
</div>

<script>
    const Game = {
        gold: 1500, atk: 25, def: 5, hp: 100, mhp: 100, ehp: 100, emhp: 100,
        inv: [], stage: 1, pos: 0, dir: 1, speed: 3, isMoving: false, 
        selectedMode: null, currentTab: 'p-battle', workshopSelection: [], currentEquip: null,

        init() {
            this.genShop();
            this.spawn();
            this.loop();
            this.update();
        },

        // ìƒì  ë³µêµ¬: 100ê°œì˜ ë‹¤ì–‘í•œ ì•„ì´í…œ ìƒì„± ë¡œì§
        genShop() {
            const list = document.getElementById('shop-list');
            list.innerHTML = `<div class="item-card"><b>ğŸ· ê¸°ì´ˆ ì²´ë ¥ ë¬¼ì•½</b><button onclick="Game.buy('pot', 50, 300)">300G</button></div>`;
            
            const pre = ["ë‚ ì¹´ë¡œìš´", "ì „ì„¤ì˜", "ì‹¬ì—°ì˜", "ê³ ëŒ€", "ë¹›ë‚˜ëŠ”", "ë…¹ìŠ¨", "ìš°ì£¼", "ê·¸ë¦¼ì", "í”¼ì˜", "ì‹ ì„±í•œ"];
            const mid = ["ë¨¹ë¬¼", "ìƒ¤í”„ì‹¬", "ì‰í¬", "í‘ì—°", "ê¹ƒí„¸", "ë‚˜ë¬´", "ì² ì œ", "ìˆ˜ì •", "ì˜í˜¼", "ì€í•˜"];
            const suf = ["íœì´‰", "ì—°í•„", "ë§Œë…„í•„", "ì§€ìš°ê°œ", "ë¶“", "ìƒ¤í”„"];

            for(let i=1; i<=100; i++) {
                const name = `${pre[i%10]} ${mid[(i+3)%10]}${suf[i%6]} Lv.${i}`;
                const price = i * 400;
                const power = i * 15;
                list.innerHTML += `
                    <div class="item-card">
                        <div><b>${name}</b><br><small>ê³µê²©ë ¥ +${power}</small></div>
                        <button onclick="Game.buy('eq', ${power}, ${price}, '${name}')">${price}G</button>
                    </div>`;
            }
        },

        buy(type, val, price, name) {
            if(this.gold < price) return alert("ê³¨ë“œê°€ ë¶€ì¡±í•©ë‹ˆë‹¤!");
            this.gold -= price;
            if(type === 'pot') {
                this.inv.push({ name: "ì²´ë ¥ ë¬¼ì•½", type: "pot", val: val });
            } else {
                this.inv.push({ name: name, type: "eq", atk: val, enchants: [] });
            }
            alert("êµ¬ë§¤ ì™„ë£Œ!");
            this.update();
        },

        // íƒ­ ì´ë™ ë° ë¦¬ìŠ¤íŠ¸ ë Œë”ë§
        tab(id) {
            this.currentTab = id;
            this.workshopSelection = [];
            document.querySelectorAll('.panel').forEach(p => p.classList.remove('active'));
            document.getElementById(id).classList.add('active');
            
            if(id === 'p-inv') this.renderList('inv-list', 'use');
            if(id === 'p-fuse') this.renderList('fuse-list', 'fuse');
            if(id === 'p-alch') this.renderList('alch-list', 'alch');
            if(id === 'p-ench') this.renderList('ench-list', 'ench');
        },

        renderList(containerId, mode) {
            const container = document.getElementById(containerId);
            container.innerHTML = "";
            this.inv.forEach((item, i) => {
                const isSelected = this.workshopSelection.includes(i);
                const card = document.createElement('div');
                card.className = `item-card ${isSelected ? 'selected' : ''}`;
                
                let info = item.type === 'eq' ? `(âš”ï¸${item.atk})` : `(ğŸ·${item.val})`;
                let enchantTags = (item.enchants || []).map(e => `<span class="enchant-tag">[${e.name}]</span>`).join('');
                
                card.innerHTML = `<div>${item.name} ${info}<br>${enchantTags}</div>`;
                card.onclick = () => this.handleSelect(i, mode);
                container.appendChild(card);
            });
        },

        handleSelect(i, mode) {
            if(mode === 'use') {
                this.useItem(i);
            } else if(mode === 'ench') {
                this.workshopSelection = [i];
            } else {
                const idx = this.workshopSelection.indexOf(i);
                if(idx > -1) this.workshopSelection.splice(idx, 1);
                else if(this.workshopSelection.length < 2) this.workshopSelection.push(i);
            }
            this.tab(this.currentTab);
        },

        // --- ê³µë°© í•µì‹¬ ë¡œì§ ---
        doEnchant() {
            if(this.workshopSelection.length < 1) return alert("ëŒ€ìƒì„ ì„ íƒí•˜ì„¸ìš”.");
            if(this.gold < 500) return alert("ê³¨ë“œ ë¶€ì¡± (500G í•„ìš”)");
            
            const item = this.inv[this.workshopSelection[0]];
            if(item.type !== 'eq') return alert("ì¥ë¹„ì—ë§Œ ì¸ì±ˆíŠ¸ ê°€ëŠ¥!");

            this.gold -= 500;
            const effects = [
                { name: "ë°œí™”", type: "dot" }, { name: "í¡í˜ˆ", type: "heal" },
                { name: "ê°•íƒ€", type: "mul" }, { name: "ì‹ ì†", type: "speed" }
            ];
            const res = effects[Math.floor(Math.random() * effects.length)];
            item.enchants.push(res);
            item.name = res.name + "ì˜ " + item.name;
            alert(`[${res.name}] ì¸ì±ˆíŠ¸ ì„±ê³µ!`);
            this.update();
            this.tab('p-inv');
        },

        doFuse() {
            if(this.workshopSelection.length < 2) return alert("ì¬ë£Œ 2ê°œë¥¼ ì„ íƒí•˜ì„¸ìš”.");
            const [idx1, idx2] = this.workshopSelection;
            const i1 = this.inv[idx1]; const i2 = this.inv[idx2];
            if(i1.type !== 'eq' || i2.type !== 'eq') return alert("ì¥ë¹„ë§Œ í•©ì„± ê°€ëŠ¥!");

            const newAtk = Math.max(i1.atk, i2.atk) + 20;
            const combinedEnchants = [...i1.enchants, ...i2.enchants].slice(0, 3);
            const newName = "â­ ìœµí•©ëœ " + i1.name.split(" ").pop();

            this.inv.splice(Math.max(idx1, idx2), 1);
            this.inv.splice(Math.min(idx1, idx2), 1);
            this.inv.push({ name: newName, type: 'eq', atk: newAtk, enchants: combinedEnchants });
            alert("í“¨ì¦ˆ ì™„ë£Œ! ê°•ë ¥í•œ ë¬´ê¸°ê°€ íƒ„ìƒí–ˆìŠµë‹ˆë‹¤.");
            this.tab('p-inv');
        },

        doAlch() {
            if(this.workshopSelection.length < 2) return alert("ë¬¼ì•½ 2ê°œë¥¼ ì„ íƒí•˜ì„¸ìš”.");
            const [idx1, idx2] = this.workshopSelection;
            if(this.inv[idx1].type !== 'pot' || this.inv[idx2].type !== 'pot') return alert("ë¬¼ì•½ë§Œ ì—°ì„± ê°€ëŠ¥!");

            const newVal = this.inv[idx1].val + this.inv[idx2].val + 30;
            this.inv.splice(Math.max(idx1, idx2), 1);
            this.inv.splice(Math.min(idx1, idx2), 1);
            this.inv.push({ name: "ğŸ§ª ê³ ë†ì¶• ë¬¼ì•½", type: 'pot', val: newVal });
            alert("ì—°ê¸ˆìˆ  ì„±ê³µ!");
            this.tab('p-inv');
        },

        useItem(i) {
            const item = this.inv[i];
            if(item.type === 'pot') {
                this.hp = Math.min(this.mhp, this.hp + item.val);
                this.inv.splice(i, 1);
                alert("ì²´ë ¥ íšŒë³µ!");
            } else {
                this.currentEquip = item;
                this.atk = 25 + item.atk;
                alert(`${item.name} ì¥ì°© ì™„ë£Œ!`);
            }
            this.update();
            this.tab('p-battle');
        },

        // --- ì „íˆ¬ ë¡œì§ ---
        selectMode(m) {
            this.selectedMode = m;
            this.isMoving = true;
            document.querySelectorAll('.btn-act').forEach(b => b.classList.remove('selected'));
            event.target.classList.add('selected');
            document.getElementById('main-btn').disabled = false;
            document.getElementById('main-btn').innerText = "íƒ€ì´ë° ë§ì¶° í´ë¦­!";
        },

        execute() {
            if(!this.isMoving) return;
            this.isMoving = false;
            const p = this.pos;
            let res = (p >= 80) ? "crit" : (p >= 30 && p <= 80) ? "hit" : "miss";

            if(res !== "miss") {
                let dmg = this.atk * (res === "crit" ? 2 : 1);
                
                // ì¸ì±ˆíŠ¸ íš¨ê³¼ ë°œë™
                if(this.currentEquip && this.currentEquip.enchants) {
                    this.currentEquip.enchants.forEach(e => {
                        if(e.type === 'mul') dmg *= 1.5;
                        if(e.type === 'heal') this.hp = Math.min(this.mhp, this.hp + 5);
                        if(e.type === 'dot') {
                            let dotCnt = 0;
                            let dotInterval = setInterval(() => {
                                this.ehp -= 10; this.update();
                                if(++dotCnt >= 3 || this.ehp <= 0) clearInterval(dotInterval);
                            }, 500);
                        }
                    });
                }
                
                this.ehp -= Math.floor(dmg);
                document.getElementById('e-unit').classList.add('shake');
                setTimeout(()=>document.getElementById('e-unit').classList.remove('shake'), 200);
                if(this.ehp <= 0) this.win();
            } else {
                this.enemyTurn();
            }
            this.resetTurn();
            this.update();
        },

        enemyTurn() {
            setTimeout(() => {
                const dmg = 10 + (this.stage * 5);
                this.hp -= dmg;
                document.getElementById('h-unit').classList.add('shake');
                if(this.hp <= 0) { alert("ê²Œì„ ì˜¤ë²„!"); location.reload(); }
                this.update();
            }, 500);
        },

        win() {
            this.gold += (this.stage * 200);
            this.stage++;
            alert(`ìŠ¹ë¦¬! ${this.stage*200}G íšë“`);
            this.spawn();
        },

        spawn() {
            this.emhp = this.ehp = 100 + (this.stage * 80);
            this.update();
        },

        update() {
            document.getElementById('u-gold').innerText = this.gold.toLocaleString();
            document.getElementById('u-atk').innerText = this.atk;
            document.getElementById('u-stg').innerText = this.stage;
            document.getElementById('h-hp').style.width = (this.hp/this.mhp*100) + "%";
            document.getElementById('hp-e').style.width = (this.ehp/this.emhp*100) + "%";
        },

        loop() {
            if(this.isMoving) {
                this.pos += this.speed * this.dir;
                if(this.pos >= 100 || this.pos <= 0) this.dir *= -1;
                document.getElementById('needle').style.left = this.pos + "%";
            }
            requestAnimationFrame(() => this.loop());
        },

        resetTurn() {
            this.isMoving = false;
            document.getElementById('main-btn').disabled = true;
            document.getElementById('main-btn').innerText = "ì•¡ì…˜ ì„ íƒ";
            document.querySelectorAll('.btn-act').forEach(b => b.classList.remove('selected'));
        }
    };

    window.onload = () => Game.init();
</script>
</body>
</html>